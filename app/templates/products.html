{% extends "base.html" %}
{% block content %}
<div class="mb-4">
  <a href="/" class="px-3 py-1.5 rounded-lg bg-slate-200 hover:bg-slate-300 text-sm">Back to Main Menu</a>
</div>

<div class="rounded-2xl bg-white shadow p-6">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-lg font-medium">
      {{ "Products with Issues" if has_issues else "All Products" }}
    </h2>
    <div class="text-sm text-slate-500">Page {{ page }} of {{ pages }}</div>
  </div>

  <!-- Only narrow the first column (Artnr). No other layout changes. -->
  <style>
    #data-table th:nth-child(1),
    #data-table td:nth-child(1){
      width:64px; max-width:64px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
  </style>

  <table id="data-table" class="min-w-full text-xs">
    <thead class="text-left bg-slate-100">
      <tr>
        <th class="px-2 py-2">Artnr</th>
        <th class="px-2 py-2">Category</th>
        <th class="px-2 py-2">Name</th>
        <th class="px-2 py-2">Manufacturer</th>
        <th class="px-2 py-2">Model</th>
        <th class="px-2 py-2">EAN</th>
        <th class="px-2 py-2">Stock</th>
        <th class="px-2 py-2">Price</th>
        <th class="px-2 py-2">Shipping</th>
        <th class="px-2 py-2 text-center">Title</th>
        <th class="px-2 py-2">Suggested title</th>
        <th class="px-2 py-2 text-center">AI</th>
        <th class="px-2 py-2 text-center">EAN</th>
        <th class="px-2 py-2 text-center">Price</th>
        <th class="px-2 py-2 text-center">Image</th>
        <th class="px-2 py-2 text-center">Result</th>
        <th class="px-2 py-2 text-center">URL</th>
      </tr>
    </thead>

    <tbody>
      {% for p in items %}
      <tr class="border-b last:border-0">
        <td class="px-2 py-1">{{ p.artnr or "" }}</td>
        <td class="px-2 py-1 truncate">{{ p.category or "" }}</td>
        <td class="px-2 py-1 whitespace-normal break-words">{{ p.name or "" }}</td>
        <td class="px-2 py-1 truncate">{{ p.manufacturer or "" }}</td>
        <td class="px-2 py-1 truncate">{{ p.model or "" }}</td>
        <td class="px-2 py-1 truncate">{{ p.ean or "" }}</td>
        <td class="px-2 py-1 text-right">{{ p.stock if p.stock is not none else "" }}</td>
        <td class="px-2 py-1 text-right">{{ "%.2f"|format(p.price) if p.price is not none else "" }}</td>
        <td class="px-2 py-1 text-right">{{ "%.2f"|format(p.shipping) if p.shipping is not none else "" }}</td>

        <td class="px-2 py-1 text-center">
          {% set ns = (p.name_status or "") %}
          <span class="{{ 'text-emerald-700' if ns|lower == 'ok' else 'text-amber-700' }}">{{ ns }}</span>
        </td>
        <td class="px-2 py-1 whitespace-normal break-words">
          {{ p.name_suggested or "" }}
        </td>
        <td class="px-2 py-1 text-center">
          {% if p.ai_prompt %}
            <a class="text-indigo-700 hover:underline" title="{{ p.ai_prompt }}">view</a>
          {% else %}
            <span class="text-slate-400">-</span>
          {% endif %}
        </td>

        <td class="px-2 py-1 text-center">
          <span class="{{ 'text-emerald-700' if p.ean_status == 'ok' else 'text-amber-700' }}">{{ p.ean_status or "" }}</span>
        </td>
        <td class="px-2 py-1 text-center">
          <span class="{{ 'text-emerald-700' if p.price_status == 'ok' else 'text-amber-700' }}">{{ p.price_status or "" }}</span>
        </td>
        <td class="px-2 py-1 text-center">
          <span class="{{ 'text-emerald-700' if p.image_status == 'ok' else 'text-amber-700' }}">{{ p.image_status or "" }}</span>
        </td>
        <td class="px-2 py-1 text-center font-semibold {{ 'text-emerald-700' if p.validation_result == 'OK' else 'text-amber-700' }}">
          {{ p.validation_result or "" }}
        </td>
        <td class="px-2 py-1 text-center">
          {% if p.url %}
            <a class="text-indigo-700 hover:underline" href="{{ p.url }}" target="_blank">open</a>
          {% else %}
            <span class="text-slate-400">-</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="mt-4 flex items-center gap-2">
    {% if page > 1 %}
      <a class="px-3 py-1.5 rounded-lg bg-slate-200 hover:bg-slate-300"
         href="{{ base_path }}?page={{ page - 1 }}&size={{ size }}">Prev</a>
    {% else %}
      <span class="px-3 py-1.5 rounded-lg bg-slate-100 text-slate-400">Prev</span>
    {% endif %}

    {% if page < pages %}
      <a class="px-3 py-1.5 rounded-lg bg-slate-200 hover:bg-slate-300"
         href="{{ base_path }}?page={{ page + 1 }}&size={{ size }}">Next</a>
    {% else %}
      <span class="px-3 py-1.5 rounded-lg bg-slate-100 text-slate-400">Next</span>
    {% endif %}
  </div>
</div>
{% endblock %}
