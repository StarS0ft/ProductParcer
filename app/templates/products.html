{% extends "base.html" %}
{% block content %}
<div class="mb-4">
  <a href="/" class="px-3 py-1.5 rounded-lg bg-slate-200 hover:bg-slate-300 text-sm">Back to Main Menu</a>
</div>

<div class="rounded-2xl bg-white shadow p-6">

  <div class="flex items-center justify-between mb-4">
    <h2 class="text-lg font-medium">
      {{ "Products with Issues" if has_issues else "All Products" }}
    </h2>
    <div class="text-sm text-slate-500">Page {{ page }} of {{ pages }}</div>
  </div>

  <!-- Responsive scroll wrapper -->
  <div class="overflow-x-auto">
    <table class="min-w-full text-xs whitespace-nowrap">
      <thead class="text-left bg-slate-100">
        <tr>
          <!-- Reduced padding px-2 instead of px-3 -->
          <th class="px-2 py-2">Artnr</th>
          <th class="px-2 py-2">Category</th>
          <th class="px-2 py-2 w-64">Name</th>
          <th class="px-2 py-2">Manufacturer</th>
          <th class="px-2 py-2">Model</th>
          <th class="px-2 py-2">EAN</th>
          <th class="px-2 py-2">Stock</th>
          <th class="px-2 py-2">Price</th>
          <th class="px-2 py-2">Shipping</th>

          <th class="px-2 py-2">EAN</th>
          <th class="px-2 py-2">Price</th>
          <th class="px-2 py-2">Image</th>
          <th class="px-2 py-2">Result</th>
          <th class="px-2 py-2">URL</th>
        </tr>
      </thead>
      <tbody>
        {% for p in items %}
        <tr class="border-b last:border-0">
          <td class="px-2 py-1">{{ p.artnr or "" }}</td>
          <td class="px-2 py-1">{{ p.category or "" }}</td>
          <!-- allow wrapping for long titles -->
          <td class="px-2 py-1 whitespace-normal max-w-xs">{{ p.name or "" }}</td>
          <td class="px-2 py-1">{{ p.manufacturer or "" }}</td>
          <td class="px-2 py-1">{{ p.model or "" }}</td>
          <td class="px-2 py-1">{{ p.ean or "" }}</td>
          <td class="px-2 py-1">{{ p.stock if p.stock is not none else "" }}</td>
          <td class="px-2 py-1">{{ "%.2f"|format(p.price) if p.price is not none else "" }}</td>
          <td class="px-2 py-1">{{ "%.2f"|format(p.shipping) if p.shipping is not none else "" }}</td>

          <!-- statuses compact -->
          <td class="px-2 py-1">
            <span class="{{ 'text-emerald-700' if p.ean_status == 'ok' else 'text-amber-700' }}">{{ p.ean_status }}</span>
          </td>
          <td class="px-2 py-1">
            <span class="{{ 'text-emerald-700' if p.price_status == 'ok' else 'text-amber-700' }}">{{ p.price_status }}</span>
          </td>
          <td class="px-2 py-1">
            <span class="{{ 'text-emerald-700' if p.image_status == 'ok' else 'text-amber-700' }}">{{ p.image_status }}</span>
          </td>
          <td class="px-2 py-1 font-semibold {{ 'text-emerald-700' if p.validation_result == 'OK' else 'text-amber-700' }}">
            {{ p.validation_result }}
          </td>

          <td class="px-2 py-1">
            {% if p.url %}
              <a class="text-indigo-700 hover:underline" href="{{ p.url }}" target="_blank">open</a>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="mt-4 flex items-center gap-2">
    {% if page > 1 %}
      <a class="px-3 py-1.5 rounded-lg bg-slate-200 hover:bg-slate-300"
         href="{{ base_path }}?page={{ page - 1 }}&size={{ size }}">Prev</a>
    {% else %}
      <span class="px-3 py-1.5 rounded-lg bg-slate-100 text-slate-400">Prev</span>
    {% endif %}

    {% if page < pages %}
      <a class="px-3 py-1.5 rounded-lg bg-slate-200 hover:bg-slate-300"
         href="{{ base_path }}?page={{ page + 1 }}&size={{ size }}">Next</a>
    {% else %}
      <span class="px-3 py-1.5 rounded-lg bg-slate-100 text-slate-400">Next</span>
    {% endif %}
  </div>
</div>
{% endblock %}
