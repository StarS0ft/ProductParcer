{% extends "base.html" %}
{% block content %}
<div class="mb-4">
  <a href="/" class="px-3 py-1.5 rounded-lg bg-slate-200 hover:bg-slate-300 text-sm">Back to Main Menu</a>
</div>

<div class="rounded-2xl bg-white shadow p-6">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-lg font-medium">
      {{ "Products with Issues" if has_issues else "All Products" }}
    </h2>
    <div class="text-sm text-slate-500">Page {{ page }} of {{ pages }}</div>
  </div>

  <style>
    /* Table-only compact styling (do NOT affect the rest of the UI) */
    #tbl { font-size: 12px; line-height: 1.25; width:100%; border-collapse: separate; border-spacing: 0; }
    #tbl th, #tbl td { padding: 6px 8px; vertical-align: top; }
    #tbl thead { background: #f1f5f9; } /* slate-100 */
    #tbl tr { border-bottom: 1px solid #e5e7eb; } /* slate-200 */
    #tbl tr:last-child { border-bottom: none; }

    /* Column sizing: keep human-readable columns wider, compress numeric/status */
    /* 1. Artnr: readable (wrap allowed), modest width */
    #tbl th.c-art, #tbl td.c-art { width: 110px; white-space: normal; word-break: break-word; }

    /* 2. Category / Manufacturer / Model / EAN: modest widths, text can wrap */
    #tbl th.c-cat, #tbl td.c-cat { width: 130px; }
    #tbl th.c-mfr, #tbl td.c-mfr { width: 120px; }
    #tbl th.c-mod, #tbl td.c-mod { width: 110px; }
    #tbl th.c-ean, #tbl td.c-ean { width: 150px; }

    /* 3. Name + Suggested title: allow wrapping; they take remaining flexible space */
    #tbl th.c-name, #tbl td.c-name { width: 260px; white-space: normal; word-break: break-word; }
    #tbl th.c-sug,  #tbl td.c-sug  { width: 260px; white-space: normal; word-break: break-word; }

    /* 4. Compact numeric/status columns */
    #tbl th.c-num,  #tbl td.c-num  { width: 56px; text-align: right; }
    #tbl th.c-num2, #tbl td.c-num2 { width: 66px; text-align: right; } /* price/shipping */
    #tbl th.c-st,   #tbl td.c-st   { width: 64px; text-align: center; }
    #tbl th.c-st2,  #tbl td.c-st2  { width: 60px; text-align: center; } /* ean/price/img statuses */
    #tbl th.c-res,  #tbl td.c-res  { width: 72px; text-align: center; font-weight: 600; }
    #tbl th.c-url,  #tbl td.c-url  { width: 52px; text-align: center; }

    /* Links and subtle colors */
    .lnk { color:#4338ca; }      /* indigo-700 */
    .lnk:hover { text-decoration: underline; }
    .ok  { color:#047857; }      /* emerald-700-ish */
    .warn{ color:#b45309; }      /* amber-700-ish */
    .muted{color:#94a3b8;}       /* slate-400 */
  </style>

  <table id="tbl">
    <thead>
      <tr>
        <th class="c-art">Artnr</th>
        <th class="c-cat">Category</th>
        <th class="c-name">Name</th>
        <th class="c-mfr">Manufacturer</th>
        <th class="c-mod">Model</th>
        <th class="c-ean">EAN</th>
        <th class="c-num">Stock</th>
        <th class="c-num2">Price</th>
        <th class="c-num2">Shipping</th>
        <th class="c-st">Title</th>
        <th class="c-sug">Suggested title</th>
        <th class="c-st">AI</th>
        <th class="c-st2">EAN</th>
        <th class="c-st2">Price</th>
        <th class="c-st2">Image</th>
        <th class="c-res">Result</th>
        <th class="c-url">URL</th>
      </tr>
    </thead>
    <tbody>
      {% for p in items %}
      <tr>
        <td class="c-art">{{ p.artnr or "" }}</td>
        <td class="c-cat">{{ p.category or "" }}</td>
        <td class="c-name">{{ p.name or "" }}</td>
        <td class="c-mfr">{{ p.manufacturer or "" }}</td>
        <td class="c-mod">{{ p.model or "" }}</td>
        <td class="c-ean">{{ p.ean or "" }}</td>

        <td class="c-num">{{ p.stock if p.stock is not none else "" }}</td>
        <td class="c-num2">{{ "%.2f"|format(p.price) if p.price is not none else "" }}</td>
        <td class="c-num2">{{ "%.2f"|format(p.shipping) if p.shipping is not none else "" }}</td>

        <td class="c-st">
          {% set ns = (p.name_status or "") %}
          <span class="{{ 'ok' if ns|lower == 'ok' else 'warn' }}">{{ ns }}</span>
        </td>

        <td class="c-sug">{{ p.name_suggested or "" }}</td>

        <td class="c-st">
          {% if p.ai_prompt %}
            <a class="lnk" title="{{ p.ai_prompt }}">view</a>
          {% else %}
            <span class="muted">-</span>
          {% endif %}
        </td>

        <td class="c-st2"><span class="{{ 'ok' if p.ean_status == 'ok' else 'warn' }}">{{ p.ean_status or "" }}</span></td>
        <td class="c-st2"><span class="{{ 'ok' if p.price_status == 'ok' else 'warn' }}">{{ p.price_status or "" }}</span></td>
        <td class="c-st2"><span class="{{ 'ok' if p.image_status == 'ok' else 'warn' }}">{{ p.image_status or "" }}</span></td>

        <td class="c-res"><span class="{{ 'ok' if p.validation_result == 'OK' else 'warn' }}">{{ p.validation_result or "" }}</span></td>

        <td class="c-url">
          {% if p.url %}
            <a class="lnk" href="{{ p.url }}" target="_blank">open</a>
          {% else %}
            <span class="muted">-</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="mt-4 flex items-center gap-2">
    {% if page > 1 %}
      <a class="px-3 py-1.5 rounded-lg bg-slate-200 hover:bg-slate-300"
         href="{{ base_path }}?page={{ page - 1 }}&size={{ size }}">Prev</a>
    {% else %}
      <span class="px-3 py-1.5 rounded-lg bg-slate-100 text-slate-400">Prev</span>
    {% endif %}

    {% if page < pages %}
      <a class="px-3 py-1.5 rounded-lg bg-slate-200 hover:bg-slate-300"
         href="{{ base_path }}?page={{ page + 1 }}&size={{ size }}">Next</a>
    {% else %}
      <span class="px-3 py-1.5 rounded-lg bg-slate-100 text-slate-400">Next</span>
    {% endif %}
  </div>
</div>
{% endblock %}
